[tool.poetry]
name = "infinity_emb"
version = "0.0.3"
description = "Infinity is a high-throughput, low-latency REST API for serving vector embeddings, supporting a wide range of sentence-transformer models and frameworks."
authors = ["michaelfeil <me@michaelfeil.eu>"]
license = "MIT"
readme = "README.md"
packages = [{include = "infinity_emb"}]

[tool.poetry.dependencies]
python = ">=3.10,<3.12"
# webserver
fastapi = "^0.103.2"
pydantic = ">=2.4.2,<3"
orjson = "^3.9.8"
prometheus-fastapi-instrumentator = "^6.1.0"
uvicorn = {extras = ["standard"], version = "^0.23.2"}
# basics
rich = "^13.6.0"
numpy = "^1"
typer = {extras = ["all"], version = "^0.9.0"}
# backend
torch = {version = ">=2.0.0, !=2.0.1, !=2.1.0", optional=true} 
sentence-transformers = {version = "2.2.2", optional=true} 
ctranslate2 = {version = "^3.20.0", optional=true}
optimum = {version = "^1.13.2", optional=true}
fastembed = {version = "0.1.1", optional=true} 

[tool.poetry.scripts]
infinity_emb = "infinity_emb.infinity_server:cli"

[tool.poetry.group.test.dependencies]
pytest = "^7.0.0"
pytest-mock = "*"
httpx  = "*"
asgi_lifespan = "*"
anyio = "*"
trio = "*"
coverage = {extras = ["toml"], version = "^7.3.2"}
mypy = "^1.5.1"

[tool.poetry.group.codespell.dependencies]
codespell = "^2.2.0"

[tool.poetry.group.lint.dependencies]
ruff = "^0.0.249"
types-toml = "^0.10.8.1"
types-redis = "^4.3.21.6"
types-pytz = "^2023.3.0.0"
black = "^23.1.0"
types-chardet = "^5.0.4.6"
mypy-protobuf = "^3.0.0"

[tool.poetry.extras]
ct2=["ctranslate2","torch","sentence-transformers"]
optimum=["optimum","torch","sentence-transformers"]
fastembed=["fastembed"]
torch=["torch","sentence-transformers"]
all=["ctranslate2","optimum","fastembed","torch","sentence-transformers"]

[tool.pytest.ini_options]
markers = [
    "performance: tests that measure performance (deselect with '-m \"not performance\"')",
]

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
